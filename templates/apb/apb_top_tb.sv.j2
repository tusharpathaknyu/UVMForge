//------------------------------------------------------------------------------
// APB Top Testbench - Generated by VerifAI
// Module: {{ module_name }}
//------------------------------------------------------------------------------

`timescale 1ns/1ps

module top_tb;
    
    import uvm_pkg::*;
    `include "uvm_macros.svh"
    import {{ prefix }}_pkg::*;
    
    //--------------------------------------------------------------------------
    // Clock and Reset
    //--------------------------------------------------------------------------
    logic {{ clock }};
    logic {{ reset }};
    
    // Clock generation
    initial begin
        {{ clock }} = 0;
        forever #5 {{ clock }} = ~{{ clock }};  // 100MHz
    end
    
    // Reset generation
    initial begin
        {{ reset }} = {% if reset_active_low %}1'b0{% else %}1'b1{% endif %};
        repeat (10) @(posedge {{ clock }});
        {{ reset }} = {% if reset_active_low %}1'b1{% else %}1'b0{% endif %};
    end
    
    //--------------------------------------------------------------------------
    // Interface Instance
    //--------------------------------------------------------------------------
    {{ prefix }}_if vif({{ clock }}, {{ reset }});
    
    //--------------------------------------------------------------------------
    // DUT Instance
    //--------------------------------------------------------------------------
    {{ module_name }} dut (
        .{{ clock }}    ({{ clock }}),
        .{{ reset }}    ({{ reset }}),
        .paddr          (vif.paddr),
        .psel           (vif.psel),
        .penable        (vif.penable),
        .pwrite         (vif.pwrite),
        .pwdata         (vif.pwdata),
        .prdata         (vif.prdata),
        .pready         (vif.pready),
        .pslverr        (vif.pslverr)
    );
    
    //--------------------------------------------------------------------------
    // UVM Configuration
    //--------------------------------------------------------------------------
    initial begin
        // Set virtual interface in config_db
        uvm_config_db#(virtual {{ prefix }}_if.master)::set(null, "*", "vif", vif.master);
        uvm_config_db#(virtual {{ prefix }}_if.monitor)::set(null, "*", "vif", vif.monitor);
        
        // Run test
        run_test();
    end
    
    //--------------------------------------------------------------------------
    // Waveform Dump
    //--------------------------------------------------------------------------
    initial begin
        $dumpfile("{{ prefix }}_tb.vcd");
        $dumpvars(0, top_tb);
    end
    
    //--------------------------------------------------------------------------
    // Timeout
    //--------------------------------------------------------------------------
    initial begin
        #1ms;
        `uvm_fatal("TIMEOUT", "Test timed out!")
    end
    
endmodule : top_tb
